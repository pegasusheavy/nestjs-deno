import{c as p}from"./chunk-2L6TCK4P.js";import{Ja as n,Ka as t,La as d,R as m,S as o,Xa as e,Za as a,_a as l,na as i,xa as x}from"./chunk-MJEEDWY6.js";var u=class s{static \u0275fac=function(r){return new(r||s)};static \u0275cmp=x({type:s,selectors:[["app-fastify-compat"]],decls:487,vars:28,consts:[[1,"max-w-4xl","mx-auto","px-6","py-12"],[1,"prose","prose-invert","max-w-none"],[1,"mb-12","pb-8","border-b","border-dark-500"],[1,"text-4xl","font-bold","text-text-primary","mb-4"],[1,"text-xl","text-text-secondary"],[1,"mb-12"],[1,"text-2xl","font-semibold","text-text-primary","mb-4","flex","items-center","gap-3"],[1,"text-nest-red"],[1,"text-text-secondary","mb-4"],[1,"p-4","bg-dark-800","rounded-lg","border-l-4","border-code-purple"],[1,"text-sm","text-text-secondary"],[1,"text-text-primary"],[1,"bg-dark-800","rounded-lg","border","border-dark-500","overflow-hidden","mb-6"],[1,"flex","items-center","justify-between","px-4","py-2","bg-dark-700","border-b","border-dark-500"],[1,"text-xs","text-text-muted"],[1,"p-4","!bg-transparent","!border-0","!m-0"],[1,"text-sm"],[1,"text-code-pink"],[1,"text-code-yellow"],[1,"text-code-green"],[1,"text-text-muted"],[1,"text-code-cyan"],[1,"grid","md:grid-cols-2","gap-4"],[1,"bg-dark-800","rounded-lg","border","border-dark-500","p-4"],[1,"font-semibold","text-code-purple","mb-2"],[1,"text-code-orange"],[1,"grid","md:grid-cols-2","gap-6"],[1,"font-semibold","text-text-primary","mb-3","flex","items-center","gap-2"],[1,"space-y-2","text-sm","text-text-secondary"],[1,"flex","items-center","gap-2"],[1,"bg-dark-800","rounded-lg","border","border-dark-500","overflow-hidden"],[1,"space-y-3","text-text-secondary"],[1,"flex","items-start","gap-3"],[1,"text-code-yellow","mt-1"],[1,"p-6","bg-dark-800","rounded-xl","border","border-dark-500"],[1,"text-xl","font-semibold","text-text-primary","mb-4"],[1,"flex","flex-wrap","gap-4"],["routerLink","/express-compat",1,"inline-flex","items-center","gap-2","px-4","py-2","bg-nest-red","hover:bg-nest-red-dark","text-white","text-sm","font-medium","rounded-lg","transition-colors"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],["routerLink","/api",1,"inline-flex","items-center","gap-2","px-4","py-2","bg-dark-700","hover:bg-dark-600","text-text-primary","text-sm","font-medium","rounded-lg","border","border-dark-500","transition-colors"]],template:function(r,S){r&1&&(n(0,"div",0)(1,"article",1)(2,"header",2)(3,"h1",3),e(4,"Fastify Plugins Compatibility"),t(),n(5,"p",4),e(6," Integrate Fastify hooks and plugins with the Deno adapter through our compatibility layer. "),t()(),n(7,"section",5)(8,"h2",6)(9,"span",7),e(10,"\u{1F50C}"),t(),e(11," Overview "),t(),n(12,"p",8),e(13," The Fastify compatibility layer allows you to use Fastify-style hooks and plugins with the Deno adapter. This is particularly useful if you're migrating from a Fastify-based NestJS application or want to use Fastify plugins for specific functionality. "),t(),n(14,"div",9)(15,"p",10)(16,"strong",11),e(17,"Note:"),t(),e(18," The compatibility layer focuses on Fastify's hook system and basic plugin architecture. Complex Fastify-specific features may require adaptation. "),t()()(),n(19,"section",5)(20,"h2",6)(21,"span",7),e(22,"\u{1FA9D}"),t(),e(23," Using Fastify Hooks "),t(),n(24,"p",8),e(25," Register Fastify-style hooks using the "),n(26,"code"),e(27,"useFastifyHook"),t(),e(28," method: "),t(),n(29,"div",12)(30,"div",13)(31,"span",14),e(32,"main.ts"),t()(),n(33,"pre",15)(34,"code",16)(35,"span",17),e(36,"import"),t(),e(37),n(38,"span",17),e(39,"from"),t(),e(40," "),n(41,"span",18),e(42,"'@nestjs/core'"),t(),e(43,`;
`),n(44,"span",17),e(45,"import"),t(),e(46),n(47,"span",17),e(48,"from"),t(),e(49," "),n(50,"span",18),e(51,"'@pegasusheavy/nestjs-platform-deno'"),t(),e(52,`;

`),n(53,"span",17),e(54,"const"),t(),e(55," adapter = "),n(56,"span",17),e(57,"new"),t(),e(58," "),n(59,"span",19),e(60,"DenoAdapter"),t(),e(61,`();

`),n(62,"span",20),e(63,"// onRequest hook - runs before route matching"),t(),e(64,`
adapter.`),n(65,"span",21),e(66,"useFastifyHook"),t(),e(67,"("),n(68,"span",18),e(69,"'onRequest'"),t(),e(70,", "),n(71,"span",17),e(72,"async"),t(),e(73),n(74,"span",21),e(75,"now"),t(),e(76),n(77,"span",20),e(78,"// preHandler hook - runs before the route handler"),t(),e(79,`
adapter.`),n(80,"span",21),e(81,"useFastifyHook"),t(),e(82,"("),n(83,"span",18),e(84,"'preHandler'"),t(),e(85,", "),n(86,"span",17),e(87,"async"),t(),e(88),n(89,"span",20),e(90,"// Authentication, validation, etc."),t(),e(91),n(92,"span",20),e(93,"// onSend hook - runs before sending the response"),t(),e(94,`
adapter.`),n(95,"span",21),e(96,"useFastifyHook"),t(),e(97,"("),n(98,"span",18),e(99,"'onSend'"),t(),e(100,", "),n(101,"span",17),e(102,"async"),t(),e(103),n(104,"span",17),e(105,"const"),t(),e(106," duration = Date."),n(107,"span",21),e(108,"now"),t(),e(109,`() - request.startTime;
  reply.`),n(110,"span",21),e(111,"header"),t(),e(112,"("),n(113,"span",18),e(114,"'X-Response-Time'"),t(),e(115,", "),n(116,"span",18),e(117),t(),e(118,`);
  `),n(119,"span",17),e(120,"return"),t(),e(121),n(122,"span",17),e(123,"const"),t(),e(124," app = "),n(125,"span",17),e(126,"await"),t(),e(127," NestFactory."),n(128,"span",21),e(129,"create"),t(),e(130,"(AppModule, adapter);"),t()()()(),n(131,"section",5)(132,"h2",6)(133,"span",7),e(134,"\u2705"),t(),e(135," Supported Hooks "),t(),n(136,"div",22)(137,"div",23)(138,"h3",24),e(139,"onRequest"),t(),n(140,"p",10),e(141,"Called when a request is received, before routing."),t()(),n(142,"div",23)(143,"h3",24),e(144,"preParsing"),t(),n(145,"p",10),e(146,"Called before the request body is parsed."),t()(),n(147,"div",23)(148,"h3",24),e(149,"preValidation"),t(),n(150,"p",10),e(151,"Called before validation."),t()(),n(152,"div",23)(153,"h3",24),e(154,"preHandler"),t(),n(155,"p",10),e(156,"Called just before the route handler."),t()(),n(157,"div",23)(158,"h3",24),e(159,"preSerialization"),t(),n(160,"p",10),e(161,"Called before the response is serialized."),t()(),n(162,"div",23)(163,"h3",24),e(164,"onSend"),t(),n(165,"p",10),e(166,"Called right before the response is sent."),t()(),n(167,"div",23)(168,"h3",24),e(169,"onResponse"),t(),n(170,"p",10),e(171,"Called after the response has been sent."),t()(),n(172,"div",23)(173,"h3",24),e(174,"onError"),t(),n(175,"p",10),e(176,"Called when an error occurs."),t()()()(),n(177,"section",5)(178,"h2",6)(179,"span",7),e(180,"\u{1F9E9}"),t(),e(181," Registering Plugins "),t(),n(182,"p",8),e(183," Use the "),n(184,"code"),e(185,"registerFastifyPlugin"),t(),e(186," method to register Fastify-style plugins: "),t(),n(187,"div",12)(188,"pre",15)(189,"code",16)(190,"span",20),e(191,"// Define a plugin"),t(),e(192,`
`),n(193,"span",17),e(194,"const"),t(),e(195," myPlugin = "),n(196,"span",17),e(197,"async"),t(),e(198),n(199,"span",20),e(200,"// Decorate the request"),t(),e(201,`
  fastify.`),n(202,"span",21),e(203,"decorateRequest"),t(),e(204,"("),n(205,"span",18),e(206,"'user'"),t(),e(207,", "),n(208,"span",25),e(209,"null"),t(),e(210,`);

  `),n(211,"span",20),e(212,"// Add hooks"),t(),e(213,`
  fastify.`),n(214,"span",21),e(215,"addHook"),t(),e(216,"("),n(217,"span",18),e(218,"'preHandler'"),t(),e(219,", "),n(220,"span",17),e(221,"async"),t(),e(222),n(223,"span",20),e(224,"// Authenticate user"),t(),e(225,`
    request.user = `),n(226,"span",17),e(227,"await"),t(),e(228," "),n(229,"span",21),e(230,"authenticate"),t(),e(231),n(232,"span",20),e(233,"// Register the plugin"),t(),e(234,`
adapter.`),n(235,"span",21),e(236,"registerFastifyPlugin"),t(),e(237),n(238,"span",20),e(239,"// Plugin options"),t(),e(240),t()()()(),n(241,"section",5)(242,"h2",6)(243,"span",7),e(244,"\u{1F4CB}"),t(),e(245," Supported Request/Reply APIs "),t(),n(246,"div",26)(247,"div",23)(248,"h3",27)(249,"span",21),e(250,"Request"),t()(),n(251,"ul",28)(252,"li",29)(253,"span",19),e(254,"\u2713"),t(),n(255,"code"),e(256,"request.body"),t()(),n(257,"li",29)(258,"span",19),e(259,"\u2713"),t(),n(260,"code"),e(261,"request.params"),t()(),n(262,"li",29)(263,"span",19),e(264,"\u2713"),t(),n(265,"code"),e(266,"request.query"),t()(),n(267,"li",29)(268,"span",19),e(269,"\u2713"),t(),n(270,"code"),e(271,"request.headers"),t()(),n(272,"li",29)(273,"span",19),e(274,"\u2713"),t(),n(275,"code"),e(276,"request.method"),t()(),n(277,"li",29)(278,"span",19),e(279,"\u2713"),t(),n(280,"code"),e(281,"request.url"),t()(),n(282,"li",29)(283,"span",19),e(284,"\u2713"),t(),n(285,"code"),e(286,"request.id"),t()(),n(287,"li",29)(288,"span",19),e(289,"\u2713"),t(),n(290,"code"),e(291,"request.ip"),t()(),n(292,"li",29)(293,"span",19),e(294,"\u2713"),t(),n(295,"code"),e(296,"request.hostname"),t()(),n(297,"li",29)(298,"span",19),e(299,"\u2713"),t(),n(300,"code"),e(301,"request.log"),t()()()(),n(302,"div",23)(303,"h3",27)(304,"span",21),e(305,"Reply"),t()(),n(306,"ul",28)(307,"li",29)(308,"span",19),e(309,"\u2713"),t(),n(310,"code"),e(311,"reply.code(statusCode)"),t()(),n(312,"li",29)(313,"span",19),e(314,"\u2713"),t(),n(315,"code"),e(316,"reply.status(statusCode)"),t()(),n(317,"li",29)(318,"span",19),e(319,"\u2713"),t(),n(320,"code"),e(321,"reply.header(key, value)"),t()(),n(322,"li",29)(323,"span",19),e(324,"\u2713"),t(),n(325,"code"),e(326,"reply.headers(obj)"),t()(),n(327,"li",29)(328,"span",19),e(329,"\u2713"),t(),n(330,"code"),e(331,"reply.type(contentType)"),t()(),n(332,"li",29)(333,"span",19),e(334,"\u2713"),t(),n(335,"code"),e(336,"reply.send(payload)"),t()(),n(337,"li",29)(338,"span",19),e(339,"\u2713"),t(),n(340,"code"),e(341,"reply.redirect(url)"),t()(),n(342,"li",29)(343,"span",19),e(344,"\u2713"),t(),n(345,"code"),e(346,"reply.sent"),t()(),n(347,"li",29)(348,"span",19),e(349,"\u2713"),t(),n(350,"code"),e(351,"reply.statusCode"),t()(),n(352,"li",29)(353,"span",19),e(354,"\u2713"),t(),n(355,"code"),e(356,"reply.getHeaders()"),t()()()()()(),n(357,"section",5)(358,"h2",6)(359,"span",7),e(360,"\u{1F4DD}"),t(),e(361," Logging "),t(),n(362,"p",8),e(363," The compatibility layer provides a Fastify-compatible logger: "),t(),n(364,"div",30)(365,"pre",15)(366,"code",16),e(367,"adapter."),n(368,"span",21),e(369,"useFastifyHook"),t(),e(370,"("),n(371,"span",18),e(372,"'onRequest'"),t(),e(373,", "),n(374,"span",17),e(375,"async"),t(),e(376),n(377,"span",21),e(378,"info"),t(),e(379,"("),n(380,"span",18),e(381,"'Request received'"),t(),e(382,`);
  request.log.`),n(383,"span",21),e(384,"debug"),t(),e(385),n(386,"span",18),e(387,"'Request headers'"),t(),e(388,`);
  request.log.`),n(389,"span",21),e(390,"warn"),t(),e(391,"("),n(392,"span",18),e(393,"'Something might be wrong'"),t(),e(394,`);
  request.log.`),n(395,"span",21),e(396,"error"),t(),e(397),n(398,"span",18),e(399,"'An error occurred'"),t(),e(400),t()()()(),n(401,"section",5)(402,"h2",6)(403,"span",7),e(404,"\u{1F527}"),t(),e(405," Manual Hook Wrapping "),t(),n(406,"p",8),e(407," For advanced use cases, use the "),n(408,"code"),e(409,"wrapFastifyHook"),t(),e(410," function directly: "),t(),n(411,"div",30)(412,"pre",15)(413,"code",16)(414,"span",17),e(415,"import"),t(),e(416),n(417,"span",17),e(418,"from"),t(),e(419," "),n(420,"span",18),e(421,"'@pegasusheavy/nestjs-platform-deno'"),t(),e(422,`;

`),n(423,"span",17),e(424,"const"),t(),e(425," myHook = "),n(426,"span",17),e(427,"async"),t(),e(428),n(429,"span",20),e(430,"// Your hook logic"),t(),e(431),n(432,"span",17),e(433,"const"),t(),e(434," wrappedHook = "),n(435,"span",21),e(436,"wrapFastifyHook"),t(),e(437,"("),n(438,"span",18),e(439,"'preHandler'"),t(),e(440,`, myHook);

`),n(441,"span",20),e(442,"// Use with the adapter"),t(),e(443,`
adapter.`),n(444,"span",21),e(445,"use"),t(),e(446,"(wrappedHook);"),t()()()(),n(447,"section",5)(448,"h2",6)(449,"span",7),e(450,"\u26A0\uFE0F"),t(),e(451," Differences from Native Fastify "),t(),n(452,"ul",31)(453,"li",32)(454,"span",33),e(455,"!"),t(),n(456,"span"),e(457,"Schema-based validation is not included; use NestJS pipes instead"),t()(),n(458,"li",32)(459,"span",33),e(460,"!"),t(),n(461,"span"),e(462,"Fastify's encapsulation context is simplified"),t()(),n(463,"li",32)(464,"span",33),e(465,"!"),t(),n(466,"span"),e(467,"Serializers and content-type parsers work differently"),t()(),n(468,"li",32)(469,"span",33),e(470,"!"),t(),n(471,"span"),e(472,"Some advanced plugin patterns may require adaptation"),t()()()(),n(473,"section",34)(474,"h2",35),e(475,"See Also"),t(),n(476,"div",36)(477,"a",37)(478,"span"),e(479,"Express Compatibility"),t(),m(),n(480,"svg",38),d(481,"path",39),t()(),o(),n(482,"a",40)(483,"span"),e(484,"API Reference"),t(),m(),n(485,"svg",38),d(486,"path",39),t()()()()()()),r&2&&(i(37),l(" ","{"," NestFactory ","}"," "),i(9),l(" ","{"," DenoAdapter ","}"," "),i(27),a(" (request, reply) => ","{",`
  request.startTime = Date.`),i(3),a(`();
`,"}",`);

`),i(12),a(" (request, reply) => ","{",`
  `),i(3),a(`
`,"}",`);

`),i(12),a(" (request, reply, payload) => ","{",`
  `),i(14),l("`$","{","duration","}","ms`"),i(4),a(` payload;
`,"}",`);

`),i(77),a(" (fastify, options) => ","{",`
  `),i(24),a(" (request, reply) => ","{",`
    `),i(9),l(`(request);
  `,"}",`);
`,"}",`;

`),i(6),a("(myPlugin, ","{",`
  `),i(3),a(`
`,"}",");"),i(136),a(" (request, reply) => ","{",`
  request.log.`),i(9),l("(","{"," headers: request.headers ","}",", "),i(12),l("(","{"," err: error ","}",", "),i(3),a(`);
`,"}",");"),i(16),l(" ","{"," wrapFastifyHook ","}"," "),i(12),a(" (request, reply) => ","{",`
  `),i(3),a(`
`,"}",`;

`))},dependencies:[p],encapsulation:2})};export{u as FastifyCompat};
